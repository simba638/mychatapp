<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Chat App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }
    .msg { padding: 5px; border-bottom: 1px solid #eee; }
    input { padding: 8px; width: 70%; }
    button { padding: 8px; }
  </style>
</head>
<body>
  <h2>ðŸ”¥ My Chat App</h2>
  <div id="messages"></div>
  <input id="messageInput" type="text" placeholder="Type a message..." />
  <button onclick="sendMessage()">Send</button>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyC_z1WBPfo_OYXezN7t8zTV27nc3veWe9M",
      authDomain: "mychatapp-fdf70.firebaseapp.com",
      projectId: "mychatapp-fdf70",
      storageBucket: "mychatapp-fdf70.firebasestorage.app",
      messagingSenderId: "899929177351",
      appId: "1:899929177351:web:9148c13f1ee5b39b1b19a2",
      measurementId: "G-FQMC73V50K"
    };

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Send message function
    async function sendMessage() {
      const input = document.getElementById("messageInput");
      if (input.value.trim() === "") return;
      await addDoc(collection(db, "messages"), {
        text: input.value,
        timestamp: serverTimestamp()
      });
      input.value = "";
    }
    window.sendMessage = sendMessage; // expose function to button

    // Listen for messages
    const q = query(collection(db, "messages"), orderBy("timestamp"));
    const messagesDiv = document.getElementById("messages");

    onSnapshot(q, (snapshot) => {
      messagesDiv.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const msgDiv = document.createElement("div");
        msgDiv.classList.add("msg");
        msgDiv.textContent = data.text;
        messagesDiv.appendChild(msgDiv);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight; // auto scroll down
    });
  </script>
</body>
</html>
